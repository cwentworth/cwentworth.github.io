<html>
<head>
<script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
</head>
<body>
  <script>
  var config = {
    apiKey: "AIzaSyAUD5iUJv4iQ_zrfbqENOsXgUghMxoq5lg",
    authDomain: "lulu-3f536.firebaseapp.com",
    databaseURL: "https://lulu-3f536.firebaseio.com",
    projectId: "lulu-3f536",
    storageBucket: "",
    messagingSenderId: "204130718041"
  };
  firebase.initializeApp(config);
  var database = firebase.database();

  var acts = acts || [];

  database.ref('activities').orderByValue().on("value", function(snapshot) {
  snapshot.forEach(function(data) {
    acts.push(data.val());
    });
  });

  var mdcn = [];
  var szr = [];
  var mxMdcnDt = '';
  var mxSzrDt = '';
  var cT = '';
  var mxMdcnDtForm = '';
  var MdcnDue = '';
  var MdcnDue_raw = '';
  var deltMdcn_raw = '';
  var deltMdcn_s = '';
  var deltMdcn_m = '';
  var deltMdcn_d = '';
  var MdcnDue_raw_r = '';
  var MdcnDue_s = '';
  var MdcnDue_m = '';
  var MdcnDue_h = '';
  var MdcnStmnt = '';
  var MdcnInstructions = '';
  var deltSzr_raw = '';
  var deltSzr_s = '';
  var deltSzr_m = '';
  var deltSzr_h = '';
  var deltSzr_d = '';
  var SzrStmnt = '';

  database.ref('activities').orderByValue().on("value", function(snapshot) {
    snapshot.forEach(function(data) {
      var item = data.val();
      item.key = data.key;
      if(item.type=='medication' && item.scw=='hotdog'){
      mdcn.push(item);
      mxMdcnDt = Math.max.apply(Math, mdcn.map(function(o) { return o.dt; }));
      cT = Date.now();
      mxMdcnDtForm = new Date(mxMdcnDt);

      Date.prototype.addHours = function(h) {
         this.setTime(this.getTime() + (h*60*60*1000));
         return this;
      };

      MdcnDue = mxMdcnDtForm.addHours(12);
      MdcnDue_raw = MdcnDue.getTime();
      deltMdcn_raw = Math.abs(cT - mxMdcnDt) / 1000;
      deltMdcn_s = deltMdcn_raw % 60;
      deltMdcn_m = Math.floor(deltMdcn_raw / 60) % 60;
      deltMdcn_h = Math.floor(deltMdcn_raw / 3600) % 24;
      deltMdcn_d = Math.floor(deltMdcn_raw / 86400);

      MdcnDue_raw_r = Math.abs(MdcnDue_raw - cT) / 1000;
      MdcnDue_s = MdcnDue_raw_r % 60;
      MdcnDue_m = Math.floor(MdcnDue_raw_r / 60) % 60;
      MdcnDue_h = Math.floor(MdcnDue_raw_r / 3600) % 24;

      MdcnStmnt = 'It has been ' + deltMdcn_h + ' hour(s) and ' + deltMdcn_m + ' minute(s) since Lulu last had her medication.';

      if(MdcnDue_h < 1) {
      MdcnInstructions = "Lulu's next dose is needed in about " + MdcnDue_m + " minute(s)";
      };

      if(MdcnDue_h >= 1) {
      MdcnInstructions = "Lulu's next dose is needed in about " + MdcnDue_h + " hour(s)";
      };

      if(document.getElementById('cp1') == null) {
      var cp1 = document.createElement('p');
      var ct1 = document.createTextNode(MdcnStmnt);
      cp1.appendChild(ct1);
      cp1.className = 'txt';
      cpt.id = 'cp1'
      document.body.appendChild(cp1);
      };

     if(document.getElementById('cp2') == null) {
     var cp2 = document.createElement('p');
     var ct2 = document.createTextNode(MdcnInstructions);
     cp2.appendChild(ct2);
     cp2.className = 'txt';
     cp2.id = 'cp2'
     document.body.appendChild(cp2);
     };

    };
      if(item.type=='seizure' && item.scw=='hotdog'){
      szr.push(item);
      mxSzrDt = Math.max.apply(Math, szr.map(function(o) { return o.dt; }));
      cT = Date.now();
      deltSzr_raw = Math.abs(cT - mxSzrDt) / 1000;
      deltSzr_s = deltSzr_raw % 60;
      deltSzr_m = Math.floor(deltSzr_raw / 60) % 60;
      deltSzr_h = Math.floor(deltSzr_raw / 3600) % 24;
      deltSzr_d = Math.floor(deltSzr_raw / 86400);
      SzrStmnt = 'It has been ' + deltSzr_d + ' day(s) ' + deltSzr_h + ' hour(s) and ' + deltSzr_m + ' minute(s) since Lulu last had a seizure.';
      };

      if(document.getElementById('cp3') == null) {
      var cp3 = document.createElement('p');
      var ct3 = document.createTextNode(MdcnInstructions);
      cp3.appendChild(ct3);
      cp3.className = 'txt';
      cp3.id = 'cp3'
      document.body.appendChild(cp3);
      };

    });
      return mdcn;
      return szr;
  });
  </script>
</body>
</hmtl>
